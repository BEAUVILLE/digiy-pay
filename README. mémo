ðŸ¦… MÃ‰MO EXPRESS â€” DIGIY PAY Ã— CAISSE CENTRALE

Le paiement valide est dans payments avec status='completed', reference/transaction_ref, et un pro_id existant dans pro_accounts.

Lâ€™activation rÃ©elle des accÃ¨s se fait uniquement dans pro_modules (pas ailleurs).

pro_modules.module accepte uniquement : DRIVER, LOC, RESA, RESTO, MARKET, JOBS, BUILD, FRET_DRIVER, FRET_CLIENT, PAY (MAJUSCULE).

Toujours crÃ©er lâ€™index unique : (pro_id, module) pour Ã©viter les doublons.

Le workflow terrain = paiement â†’ fonction SQL â†’ pro_modules.

La fonction clÃ© est cashier_activate_from_payment_ref(ref) (1 call = activation).

La fonction vÃ©rifie : paiement trouvÃ©, completed, module valide, pro_id OK.

Elle fait un UPSERT dans pro_modules avec activated_at et expires_at (J+30).

Si un module existe avec expires_at IS NULL, ne pas lâ€™Ã©craser (licence illimitÃ©e).

VÃ©rif finale : select * from pro_modules order by activated_at desc;
