<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>DIGIY PAY ‚ôæÔ∏è</title>
<meta name="theme-color" content="#020617">
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.ico">

<style>
:root{--bg:#020617;--card:#020818;--ok:#22c55e;--gold:#facc15;--text:#fff;--muted:#cbd5f5;}
*{box-sizing:border-box;font-family:system-ui;margin:0;padding:0}
body{min-height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,var(--bg),#064e3b);color:var(--text);padding:14px;}
.card{width:min(520px,96vw);background:rgba(2,8,24,.96);border:1px solid #134e4a;border-radius:22px;padding:18px;text-align:center;}
h1{font-weight:950;color:var(--ok)}
.name{margin-top:14px;font-size:22px;font-weight:980;color:var(--gold)}
.hint{margin-top:6px;color:var(--muted);font-weight:800;font-size:13px}
.paybox{margin-top:14px;padding:14px;border-radius:18px;border:1px solid rgba(34,197,94,.55);background:rgba(34,197,94,.10);text-align:left;}
.tel{margin-top:6px;font-size:22px;font-weight:980;color:#ecfdf5}
.row{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
input{flex:1;padding:12px;border-radius:14px;border:1px solid rgba(148,163,184,.25);background:#020617;color:#fff;font-weight:900}
.btn{padding:12px 14px;border-radius:999px;font-weight:950;border:none;cursor:pointer}
.ghost{background:#020617;border:1px solid rgba(148,163,184,.25);color:#e5e7eb}
.msg{margin-top:12px;padding:10px;border-radius:16px;border:1px solid rgba(250,204,21,.35);background:rgba(250,204,21,.08);color:#fde68a;font-weight:850;font-size:13px}
.foot{margin-top:12px;font-size:12px;color:var(--muted);font-weight:850}
</style>
</head>

<body>
<div class="card">
<h1>DIGIY PAY ‚ôæÔ∏è</h1>
<div>Paiement direct au pro ‚Ä¢ 0% commission</div>

<div id="proName" class="name">Chargement‚Ä¶</div>
<div id="proHint" class="hint"></div>

<div id="paybox" class="paybox" style="display:none">
<div>Num√©ro Wave du pro</div>
<div class="tel" id="proPhone">‚Äî</div>
</div>

<div class="row">
<input id="codeInput" placeholder="Tester un code (ex: CHEZASTOU)">
<button id="btnLoad" class="btn ghost">üîé Charger</button>
</div>

<div id="howto" class="msg" style="display:none"></div>
<div class="foot">Ouvre Wave ‚Üí Payer ‚Üí colle le num√©ro affich√©.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL="https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

const proName=document.getElementById("proName");
const proHint=document.getElementById("proHint");
const paybox=document.getElementById("paybox");
const proPhone=document.getElementById("proPhone");
const howto=document.getElementById("howto");
const codeInput=document.getElementById("codeInput");

function getCode(){
const p=new URLSearchParams(location.search);
return (p.get("pro")||"CHEZASTOU").trim().toUpperCase();
}

async function loadPro(code){
paybox.style.display="none";howto.style.display="none";
proName.textContent="Chargement‚Ä¶";

const {data}=await sb.from("digiy_pay_pro")
.select("business_name,wave_phone")
.eq("business_code",code)
.eq("is_active",true)
.maybeSingle();

if(!data){proName.textContent="Pro introuvable";return;}

proName.textContent=data.business_name;
const tel=data.wave_phone.replace(/\D/g,"");
proPhone.textContent="+"+tel;
paybox.style.display="block";

howto.innerHTML="üëâ Dans Wave colle : <b>+"+tel+"</b><br>‚úÖ Paiement direct DIGIY";
howto.style.display="block";
}

btnLoad.onclick=()=>loadPro(codeInput.value.trim().toUpperCase());
codeInput.onkeydown=e=>{if(e.key==="Enter")btnLoad.click()};
loadPro(getCode());
</script>
</body>
</html>

