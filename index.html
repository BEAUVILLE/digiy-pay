<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>DIGIY PAY ‚ôæÔ∏è</title>
<meta name="theme-color" content="#020617">
<link rel="icon" href="/favicon.ico">
<link rel="manifest" href="/manifest.json">

<style>
:root{
--bg:#020617;--card:#020818;--ok:#22c55e;--gold:#facc15;
--text:#fff;--muted:#cbd5f5;
}
*{box-sizing:border-box;font-family:system-ui;margin:0;padding:0}
body{
min-height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(135deg,var(--bg),#064e3b);
color:var(--text);padding:14px;
}
.card{
width:min(460px,96vw);
background:rgba(2,8,24,.96);
border:1px solid #134e4a;
border-radius:22px;padding:18px;text-align:center;
}
h1{font-weight:950;color:var(--ok)}
.sub{margin-top:6px;font-weight:700}
.name{margin-top:14px;font-size:20px;font-weight:950;color:var(--gold)}
.muted{margin-top:6px;color:var(--muted);font-weight:750;font-size:13px}
input{
margin-top:12px;width:100%;padding:12px;border-radius:14px;
border:1px solid rgba(148,163,184,.25);
background:rgba(2,6,23,.75);color:#fff;font-weight:900;
}
.btn{
margin-top:12px;width:100%;padding:12px;border-radius:999px;
font-weight:950;border:none;cursor:pointer;
}
.primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#022c22}
.ghost{background:#020617;border:1px solid #134e4a;color:#e5e7eb}
.foot{margin-top:12px;font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="card">
<h1>DIGIY PAY ‚ôæÔ∏è</h1>
<div class="sub">Paiement direct au professionnel ‚Ä¢ 0% commission</div>

<div id="proName" class="name">Chargement‚Ä¶</div>
<div id="proHint" class="muted"></div>

<input id="codeInput" placeholder="Entrer un code (ex: CHEZASTOU)">
<button id="btnLoad" class="btn ghost">üîé Charger</button>

<a id="waveBtn" class="btn primary" style="display:none">üí∞ Payer avec Wave</a>

<div class="foot">Si Wave ne s‚Äôouvre pas : paie manuellement au num√©ro du pro.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL="https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

const proName=document.getElementById("proName");
const proHint=document.getElementById("proHint");
const waveBtn=document.getElementById("waveBtn");
const codeInput=document.getElementById("codeInput");

function getCode(){
const p=new URLSearchParams(location.search);
return (p.get("pro")||"CHEZASTOU").trim().toUpperCase();
}

async function loadPro(code){
waveBtn.style.display="none";
proName.textContent="Chargement‚Ä¶";
proHint.textContent="Code : "+code;

const {data,error}=await sb
.from("digiy_pay_pro")
.select("business_code,business_name,wave_phone")
.eq("business_code",code)
.eq("is_active",true)
.maybeSingle();

if(error){
proName.textContent="Erreur Supabase";
proHint.textContent=error.message;
return;
}
if(!data){
proName.textContent="Pro introuvable";
proHint.textContent="V√©rifie le code.";
return;
}

proName.textContent=data.business_name;
const phone=data.wave_phone.replace(/\D/g,"");

const waveDeep="wave://pay?phone="+phone;
const waveWeb="https://pay.wave.com/"+phone;

waveBtn.href=waveWeb;
waveBtn.style.display="block";

waveBtn.onclick=()=>{
const t=Date.now();
location.href=waveDeep;
setTimeout(()=>{if(Date.now()-t<1500)window.open(waveWeb,"_blank");},600);
};
}

btnLoad.onclick=()=>loadPro(codeInput.value.trim().toUpperCase());
codeInput.onkeydown=e=>{if(e.key==="Enter")btnLoad.click()};

loadPro(getCode());
</script>
</body>
</html>
